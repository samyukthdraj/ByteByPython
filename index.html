<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Civilians As Police (CAP)</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="window">
    <h1 class="title">Civilians As Police (CAP)</h1>

    <!-- User Name Input -->
    <div class="form-group">
      <label for="userName">Your Name:</label>
      <input type="text" id="userName" placeholder="Enter your name">
    </div>

    <!-- Image Upload -->
    <div class="form-group">
      <label for="uploadImage">Upload Image:</label>
      <input type="file" id="uploadImage" accept="image/*">
    </div>

    <!-- Voice Note Upload -->
    <div class="form-group">
      <label for="uploadVoice">Upload Voice:</label>
      <input type="file" id="uploadVoice" accept="audio/*">
    </div>

    <!-- Pincode Input -->
    <div class="form-group">
      <label for="pincode">Enter Pincode:</label>
      <input type="text" id="pincode" placeholder="e.g., 123456">
    </div>

    <!-- Police Station Dropdown -->
    <div class="form-group">
      <label for="policeStation">Nearest Police Station:</label>
      <select id="policeStation">
        <option value="">Select a station</option>
        <option value="Central Police Station">Central Police Station</option>
        <option value="Station 2">Station 2</option>
        <option value="Station 3">Station 3</option>
      </select>
    </div>

    <!-- Type of Crime Dropdown -->
    <div class="form-group">
      <label for="crimeType">Type of Crime:</label>
      <select id="crimeType">
        <option value="">Select a crime type</option>
        <option value="theft">Theft</option>
        <option value="vandalism">Vandalism</option>
        <option value="assault">Assault</option>
        <option value="fraud">Fraud</option>
        <option value="others">Others</option>
      </select>
      <div id="customCrimeType" style="display: none; margin-top: 10px;">
        <input type="text" id="customCrimeTypeInput" placeholder="Enter custom crime type">
      </div>
    </div>

    <!-- Phone Number Input -->
    <div class="form-group">
      <label for="phoneNumber">Your Phone Number:</label>
      <input type="text" id="phoneNumber" placeholder="e.g., +1234567890">
    </div>

    <!-- Description Box -->
    <div class="form-group">
      <label for="description">Description:</label>
      <textarea id="description" placeholder="Enter crime description here..."></textarea>
    </div>

    <!-- Submit Button -->
    <div class="form-group">
      <button class="submit-button" onclick="submitReport()">Submit Report</button>
    </div>
  </div>
  <script>
 function generateRandomTicketNumber() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    async function submitReport() {
      const userName = document.getElementById("userName").value;
      const pincode = document.getElementById("pincode").value;
      const policeStation = document.getElementById("policeStation").value;
      const phoneNumber = document.getElementById("phoneNumber").value;
      const crimeType = document.getElementById("crimeType").value === 'others' 
          ? document.getElementById('customCrimeTypeInput').value 
          : document.getElementById("crimeType").value;
      const description = document.getElementById("description").value;

      // Image upload handling
      const imageFile = document.getElementById("uploadImage").files[0];
      const voiceFile = document.getElementById("uploadVoice").files[0];

      const reportData = {
        user_name: userName,
        pincode,
        police_station: policeStation,
        phone_number: phoneNumber,
        crime_type: crimeType,
        description,
        ticket_number: generateRandomTicketNumber()
      };

      try {
        const response = await fetch("http://localhost:8000/upload-crime-report", {
          method: "POST",
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(reportData)
        });

        const result = await response.json();

        // Show ticket generation popup
        const popup = document.createElement('div');
        popup.innerHTML = `
          <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 2px solid blue; z-index: 1000; text-align: center;">
            <h2>Report Submitted Successfully!</h2>
            <p>Your Ticket Number is: <strong>${result.ticket_number}</strong></p>
            <button onclick="this.parentElement.remove(); window.location.href='user_dashboard.html'">View Dashboard</button>
          </div>
        `;
        document.body.appendChild(popup);
      } catch (error) {
        console.error("Error submitting report:", error);
        alert("Failed to submit report. Please try again.");
      }
    }

    // Show custom crime type input field when "Others" is selected
    document.getElementById("crimeType").addEventListener("change", function() {
      const customCrimeTypeDiv = document.getElementById("customCrimeType");
      if (this.value === "others") {
        customCrimeTypeDiv.style.display = "block";
      } else {
        customCrimeTypeDiv.style.display = "none";
      }
    });
    </script>
</body>
</html>